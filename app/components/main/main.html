
<!-- Show the system when online, here for performance and pre-load -->
<article ng-if="state == 'online'">
    <header>
        <div class="logo"><div></div></div>

        <div class="tray" ng-controller="Modals">

            <!-- 
                POWER Pop up
             -->
            <div>
                <div class="power" ng-click="showModal('power')">
                    <modal name="power" title="Shutdown?">
                        <p>
                            <b>Are you sure you want to turn off the system?</b>
                            <br />It may take up to 5min to restart.
                        </p>
                        <menu>
                            <button class="cancel" ng-touch="closeModal('power')">Cancel</button>
                            <button class="ok" ng-touch="coModuleInstance.$exec('shutdown')">Shutdown</button>
                        </menu>
                        <div style="clear: both"></div>
                    </modal>
                </div>
            </div>

            <!-- 
                HELP Pop up
             -->
            <div>
                <div class="help" ng-click="showModal('help')">
                    <modal name="help" title="Call for Help">
                        <p>For help please call <strong>0408419954</strong></p>
                    </modal>
                </div>
            </div>

            <!-- 
                Lighting Pop up
             -->
            <div co-bind="'lights'">
                <div class="lights" ng-if="lights" co-bind="'light_level'" exec ng-click="showModal('lights')">
                    <modal name="lights" title="Lighting Modes">
                        <div btn-group="light_level">
                            <button ng-repeat="level in lights.levels" btn="level.name" ng-click="$parent.$parent.$parent.light_level = level.name">{{level.name}}</button>
                        </div>
                    </modal>
                </div>
            </div>
        </div>
    </header>

    <div co-bind="'inputs'">
        <div co-bind="'tab'" exec>
            <!-- Tabs -->
            <tabs current="tab" auto-select="false">
                <pane ng-repeat="input in inputs" title="{{input}}" icon="{{input}}">
                    <div ng-include="'components/main/' + input + '/' + input + '.html'">
                    </div>
                </pane>
            </tabs>

            <!-- Show when more than one output available -->
            <footer ng-if="outputs && numOutputs > 1">
                <div>
                    <!-- 
                        source === what is currently displaying
                        output.type == projector / lcd / conference
                        overlay is for indicating warming / cooling / errors etc
                     -->
                    <div ng-repeat="output in outputs | orderObjectBy:'pri'"
                         co-bind="output.$key as source"
                         ng-class="output.type"
                    >
                        <div class="icon">
                            <div class="outer"></div>
                            <div class="inner" ng-class="{pulse: source !== selected}">
                                <span class="title">{{output.title || output.pri}}</span>
                                <div class="source-image" ng-class="source || 'blank'"></div>
                            </div>

                            <!--
                                Only show if a module exists for this output as
                                we'll query it directly
                            -->
                            <div ng-if="!output.no_mod"
                                 class="overlay"
                                 ng-controller="OutputCtrl"
                                 co-module="device.module"
                                 index = "device.index"
                            >
                                <div>
                                    <span co-bind="'warming'" ng-show="warming">Warming up</span>
                                    <span co-bind="'mute'" ng-show="mute">Muted</span>
                                    <span co-bind="'connected'" ng-show="!connected" class="error">Comms Error</span>
                                </div>
                            </div>
                        </div>

                        <!--
                            An output may not output any audio (VC for example)
                        -->
                        <div ng-if="!output.no_audio" class="audio">
                            <!--
                                Mixer used for audio
                                We check against undefined as 0 is falsey

                                TODO:: Either co-bind creates the variable at init or co-fader waits..
                                Probably both?
                            -->
                            <div ng-if="output.mixer_id !== undefined" co-bind="'vol_min'">
                                <div class="mute"  co-module="'Mixer'" co-bind="'fader_' + output.mixer_id + '_mute' as mute" exec="mute(output.mixer_id, mute)">
                                    <div image-toggle model="mute"></div>
                                </div>
                                <div class="volume" co-bind="'vol_max'">
                                    <div co-module="'Mixer'" co-bind="'fader_' + output.mixer_id as volume" exec="fader(output.mixer_id, volume)">
                                        <div>
                                            <div co-range model="volume" min="vol_min" max="vol_max"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
</article>
