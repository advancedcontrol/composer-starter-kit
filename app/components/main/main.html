
<!-- Show the system when online, here for performance and pre-load -->
<article ng-if="state == 'online'" ng-controller="SourceCtrl" co-bind="'sources'">
    <header co-bind="'name'">
        <div class="logo"><div></div></div>

        <div class="tray" ng-controller="Modals">

            <span class="name">{{name}}</span>

            <!-- 
                POWER Pop up
             -->
            <div>
                <div class="power" ng-click="showModal('power')">
                    <modal name="power" title="Shutdown?">
                        <p>
                            <b>Are you sure you want to turn off the system?</b>
                            <br />It may take up to 5min to restart.
                        </p>
                        <menu>
                            <button class="cancel" ng-touch="closeModal('power')">Cancel</button>
                            <button class="ok" ng-touch="coModuleInstance.$exec('shutdown')">Shutdown</button>
                        </menu>
                        <div style="clear: both"></div>
                    </modal>
                </div>
            </div>

            <!-- 
                HELP Pop up
             -->
            <div>
                <div class="help" ng-click="showModal('help')">
                    <modal name="help" title="Need Support?" co-bind="'help_msg'">
                        <p ng-bind-html="help_msg"></p>
                        <p>The room or system name is: <b>{{name}}</b></p>
                    </modal>
                </div>
            </div>

            <!-- 
                Manual Control Pop up
             -->
            <div>
                <div class="manual" ng-click="showModal('manual')">
                    <modal name="manual" title="Manual Control">
                        <h2>Displays:</h2>

                        <!-- Get the number of displays and list them -->
                        <table class="entries" co-module="'Display'" indices-of="'Display' as indices">
                            <tr ng-repeat="index in indices" co-index="index" co-bind="'power'" exec>
                                <td>{{outputs['Display_' + index].title}}</td>
                                <td><div ios-toggle model="power"></div></td>
                                <td class="onoff">{{power ? 'On' : 'Off'}}</td>
                            </tr>
                        </table>
                    </modal>
                </div>
            </div>

            <!-- 
                Lighting Pop up
             -->
            <div co-bind="'lights'">
                <div class="lights" ng-if="lights" co-bind="'light_level'" exec ng-click="showModal('lights')">
                    <modal name="lights" title="Lighting Modes">
                        <div btn-group="light_level">
                            <button ng-repeat="level in lights.levels" btn="level.name" ng-click="$parent.$parent.$parent.light_level = level.name" class="{{level.name}} toggle"><i class="fa fa-lightbulb-o"></i>{{level.name}}</button>
                        </div>
                    </modal>
                </div>
            </div>
        </div>
    </header>

    <div ng-if="sources" co-bind="'inputs'">
        <div co-bind="'tab'" exec>
            <!-- Tabs -->
            <tabs current="tab" auto-select="false">
                <pane ng-repeat="input in inputs" title="{{input}}" icon="{{input}}">
                    <div ng-include="'components/main/' + input + '/' + input + '.html'">
                    </div>
                </pane>
            </tabs>

            <!-- Show when more than one output available -->
            <footer ng-if="outputs && numOutputs > 1">
                <div>
                    <!-- 
                        source === what is currently displaying
                        output.type == projector / lcd / conference
                        overlay is for indicating warming / cooling / errors etc
                     -->
                    <div display ng-repeat="output in outputs | orderObjectBy:'pri'"
                         co-bind="output.$key as source"
                         ng-init="source = {source: 'none'}"
                         ng-class="output.type"
                    >
                        <div class="icon" ng-click="presetSource()">
                            <div class="outer"></div>
                            <div class="inner" ng-class="{pulse: doPulse}">
                                <span class="title">{{output.title || output.pri}}</span>
                                <div class="source">
                                    <div>
                                        <div class="source-image" ng-class="source.type">
                                            <span ng-if="source && source.source !== 'none'">{{source.title}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--
                                Only show if a module exists for this output as
                                we'll query it directly
                            -->
                            <div ng-if="!output.no_mod"
                                 class="overlay"
                                 co-module="device.module"
                                 index = "device.index"
                            >
                                <div>
                                    <span co-bind="'warming'" ng-show="warming">Warming up</span>
                                    <span co-bind="'mute'" ng-show="mute">Muted</span>
                                    <span co-bind="'connected'" ng-show="!connected" class="error">Comms Error</span>
                                </div>
                            </div>
                        </div>

                        <!--
                            An output may not output any audio (VC for example)
                        -->
                        <div ng-if="!output.no_audio" class="audio">
                            <!--
                                Mixer used for audio
                                We check against undefined as 0 is falsey
                            -->
                            <div ng-if="output.mixer_id !== undefined" co-bind="'vol_min'">
                                <div class="mute"  co-module="'Mixer'" co-bind="'fader_' + output.mixer_id + '_mute' as mute" exec="mute(output.mixer_id, mute)">
                                    <div image-toggle model="mute"></div>
                                </div>
                                <div class="volume" co-bind="'vol_max'">
                                    <div co-module="'Mixer'" co-bind="'fader_' + output.mixer_id as volume" exec="fader(output.mixer_id, volume)">
                                        <div>
                                            <div co-range model="volume" min="vol_min" max="vol_max"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
</article>
