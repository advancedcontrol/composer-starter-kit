
<!-- Show the system when online, here for performance and pre-load -->
<article
    class="main"
    ng-if="state === 'online'"
    ng-controller="SourceCtrl"
    co-bind="'sources'"
    ng-class="{single: numOutputs === 1 && !has_preview}"
>
    <span co-bind="'selected_camera' as selected.camera_src"></span>
    <header co-bind="'name' as $root.SystemName">
        <div class="logo"><div></div></div>

        <div class="tray" ng-include="'components/shared/popups.html'"  ng-controller="Modals"></div>
    </header>

    <div ng-if="sources" co-bind="'inputs'">
        <div co-bind="'tab'" exec>
            <!-- Tabs -->
            <tabs current="tab" auto-select="false" type="touch">
                <pane ng-repeat="input in inputs" text="{{input}}" icon="{{input}}" co-bind="input + '_hide' as hide" hide="hide">
                    <div ng-include="'components/main/' + input + '/' + input + '.html'">
                    </div>
                </pane>
            </tabs>

            <!-- Show when more than one output available -->
            <span co-bind="'joined'"></span>
            <footer ng-if="outputs && (numOutputs > 1 || has_preview)">
                <div ng-class="{singleaudioout: single_audio_out}">
                    <!-- 
                        source === what is currently displaying
                        output.type == projector / lcd / conference
                        overlay is for indicating warming / cooling / errors etc
                     -->
                    <div display ng-repeat="output in outputs | orderObjectBy:'pri'"
                         co-bind="output.$key as source"
                         ng-init="source = {source: 'none'}"
                         ng-class="output.type"
                         ng-controller="JointAudioCtrl"
                    >
                        <span co-bind="output.$key + '_volume' as shared.volume" exec="share_volume(output.$key, shared.volume)"></span>
                        <span co-bind="output.$key + '_amute' as audio.mute" exec="share_mute(output.$key, audio.mute)"></span>

                        <span class="audio-select" ng-if="single_audio_out">
                            <label style="font-size: larger"><span> <i class="fa fa-volume-up"></i></span><input type="checkbox" /></label>
                        </span>

                        <div class="icon" touch-action="pan-x" ng-click="presetSource()">
                            <div class="outer"></div>
                            <div class="inner" ng-class="{pulse: doPulse}">
                                <span class="title">{{output.title || output.pri}}</span>
                                <div class="source">
                                    <div>
                                        <div class="source-image" ng-class="source.type">
                                            <span ng-if="source && source.source !== 'none'">{{source.title}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--
                                Only show if a module exists for this output as
                                we'll query it directly
                            -->
                            <div ng-if="!output.no_mod"
                                 class="overlay"
                                 co-module="device.module"
                                 index = "device.index"
                                 co-bind="'power'"
                            >
                                <div>
                                    <span co-bind="'warming'" ng-show="warming">Warming up</span>
                                    <span co-bind="'mute'" ng-show="mute && power">Muted</span>
                                    <span co-bind="'connected'" ng-show="!connected" class="error">Comms Error</span>
                                </div>
                            </div>
                        </div>

                        <!--
                            An output may not output any audio (VC for example)
                        -->
                        <div
                            ng-if="!(output.no_audio || output.hide_audio || output.single_audio_out)"
                            class="audio"
                            ng-include="'components/shared/audio.html'"
                        ></div>
                    </div>
                </div>
                <div class="single_audio_out" ng-if="single_audio_out == true">
                    <div
                        class="audio"
                        ng-include="'components/shared/audio.html'"
                    ></div>
                </div>
            </footer>
            <footer ng-if="outputs && numOutputs === 1 && !has_preview" ng-controller="JointAudioCtrl" class="audio-only">
                <div ng-repeat="output in outputs | orderObjectBy:'pri'"
                     co-bind="output.$key as source"
                     ng-controller="JointAudioCtrl"
                >
                    <span co-bind="output.$key + '_volume' as shared.volume" exec="share_volume(output.$key, shared.volume)"></span>
                    <span co-bind="output.$key + '_amute' as audio.mute" exec="share_mute(output.$key, audio.mute)"></span>

                    <h1>Volume:</h1>
                    <div
                        class="audio"
                        ng-include="'components/shared/audio.html'"
                    ></div>
                </div>
            </footer>
        </div>
    </div>
</article>
