
<article
    ng-if="state === 'online'"
    ng-controller="SidebarCtrl"

    ng-swipe-left="hideNav()"
    ng-swipe-right="showNav()"

    drag-begin="dragStartNav($event)"
    ng-drag="dragNav($event)"
    drag-stop="dragEndNav()"
    drag-directions="'left right'"

    drag-y-axis="false"
    user-select="true"

    class="mobile"
    ng-class="{
        navAnimate: navAnimate,
        navDecorate: navDecorate,
        navOpen: navOpen,
        noAuth: !authenticated
    }"
>
    <div
        id="touch-overlay" 
        ng-touch="toggleNav()"
    >
        <!--
            For closing the mobile sidebar when it is showing
            Provides a touch area over the sliver of the visible content
         -->
    </div>

    <header 
        class="promote-layer" 
        ng-touch="$event.stopPropagation()" 
        user-select="true" 
        no-capture
    >
        <span co-bind="'name'" class="name">{{name}}</span>

        <span id="show-menu" ng-touch="toggleNav()">
            <div class="logo"></div>
        </span>
    </header>

    <aside class="promote-layer">
        <div id="aside-wrapper">
            <div id="nav-buffer">
                <!-- Place the popup actions here -->
                <div class="tray" ng-include="'components/shared/popups.html'"  ng-controller="Modals"></div>
            </div>

            <div 
                id="nav-wrapper"
                ng-include="'components/mobile/sources/' + (selectedSource.type || 'none') + '/source.html'"
            >
            </div>
        </div>
    </aside>

    <div id="mobile-sources" co-bind="'sources'" ng-init="current_output = null">

        <div ng-if="numOutputs > 1">
            <h2>Select display(s):</h2>
            <!-- Output lists -->
            <select
                ng-model="$parent.current_output"
                ng-options="key as output.title for (key, output) in outputs"
                ng-touch="$event.stopPropagation()" 
                user-select="true" 
                no-capture
            >
                <option value="">all displays</option>
            </select>

            <span
                ng-if="outputs[current_output].type == 'projector'"
                co-module="current_output"
                co-implicit-index
            >
                <button
                    co-bind="'mute'"
                    exec

                    class="toggle inline"
                    ng-class="{active: mute}"
                    ng-click="mute=!!!mute"
                >
                    Mute
                </button>
            </span>

            <h2>Select what to show:</h2>
        </div>

        <div ng-if="numOutputs === 1">
            <h2>Select what to show on the display:</h2>
        </div>

        <div ng-if="current_output === null" ng-init="$parent.current_output = ''"></div>

        <!-- Source Selection -->
        <div 
            ng-if="sources" 
            co-bind="current_output as disp_source"
            exec="present(disp_source, current_output)"
        >
            <div btn-group="disp_source.source" class="sources">
                <button ng-repeat="(key, info) in sources" btn="key" ng-click="$parent.disp_source = key" class="toggle">
                    <span ng-class="info.type"></span>{{info.title}}
                </button>
            </div>
        </div>
    </div>
</article>
